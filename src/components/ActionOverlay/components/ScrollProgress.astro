---
import { MIN_SM_BREAKPOINT } from '@/lib/consts';

const SCROLL_PROGRESS_ID = 'scroll-progress';
---

<div class="bg-3 hidden h-[50vh] w-px sm:block" aria-hidden="true">
  <div class="h-full bg-current" id={SCROLL_PROGRESS_ID}></div>
</div>

<script is:inline define:vars={{ SCROLL_PROGRESS_ID, MIN_SM_BREAKPOINT }}>
  const scrollProgress = document.getElementById(SCROLL_PROGRESS_ID);
  const mediaQuery = window.matchMedia(MIN_SM_BREAKPOINT);

  function updateScroll() {
    if (scrollProgress) {
      const maxScroll = Math.max(
        document.documentElement.scrollHeight - window.innerHeight,
        1,
      );

      const ratio = Math.min(
        Math.max(document.documentElement.scrollTop / maxScroll, 0),
        1,
      );

      scrollProgress.style.transform = `scaleY(${ratio})`;
    }
  }

  const handleViewportChange = ({ matches }) => {
    if (matches) {
      updateScroll();
      window.addEventListener('scroll', updateScroll);
    } else {
      window.removeEventListener('scroll', updateScroll);
    }
  };

  mediaQuery.addEventListener('change', handleViewportChange);
  handleViewportChange(mediaQuery);
</script>
